{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
    <h1 class="title">Welcome to Our Site</h1>
    <div id="chatbox" style="width: 100%; height: 400px; border: 1px solid #ccc; padding: 10px; overflow-y: scroll;"></div>
    <input type="text" id="userInput" placeholder="Type a message..." style="width: 100%; padding: 10px;">

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
        // Configure AWS SDK with Cognito Identity Pool
        AWS.config.region = 'us-east-1';
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
            IdentityPoolId: 'us-east-1:5e9d2d8a-2a1b-4a07-9c31-4e428cae6ab1'
        });

        // Create Lex runtime service object
        var lexruntime = new AWS.LexRuntime();

        // Function to send message to Lex
        function sendMessageToLex() {
            var userInput = document.getElementById('userInput').value;

            var params = {
                botAlias: '$LATEST',
                botName: 'BusGPT', // Replace with your bot name
                inputText: userInput,
                userId: 'user-' + Date.now(), // Unique user ID
            };

            lexruntime.postText(params, function(err, data) {
                if (err) {
                    console.log(err, err.stack);
                } else {
                    var chatbox = document.getElementById('chatbox');
                    var userDiv = document.createElement('div');
                    userDiv.textContent = 'You: ' + userInput;
                    chatbox.appendChild(userDiv);

                    var lexDiv = document.createElement('div');
                    lexDiv.textContent = 'Bot: ' + data.message;
                    chatbox.appendChild(lexDiv);
                }
            });

            document.getElementById('userInput').value = '';
        }

        // Event listener for user input
        document.getElementById('userInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessageToLex();
            }
        });
    </script>
{% endblock %}